{
  "version": 3,
  "sources": ["../src/index.ts", "../src/effectScope.ts", "../src/effect.ts", "../../shared/src/index.ts", "../src/baseHandler.ts", "../src/reactive.ts", "../src/computed.ts", "../src/watch.ts", "../src/ref.ts"],
  "sourcesContent": ["import { effect, ReactiveEffect } from './effect';\r\nimport { reactive } from './reactive';\r\nimport { MyIsObject, MyIsFunction } from '@vue/shared';\r\nimport { computed } from './computed';\r\nimport { watch } from './watch';\r\nimport { ref, toRefs, toRef, proxyRefs } from './ref';\r\n\r\nexport {\r\n  toRefs,\r\n  toRef,\r\n  ref,\r\n  effect,\r\n  reactive,\r\n  MyIsObject,\r\n  computed,\r\n  MyIsFunction,\r\n  watch,\r\n  proxyRefs,\r\n  ReactiveEffect,\r\n};\r\n\r\n\r\nexport * from './effectScope';", "\r\nlet activeEffectsScope = null\r\nclass EffectScope {\r\n    active = true;\r\n    parent = null;\r\n    effects = []\r\n    scopes = []; //-->\u6536\u96C6\u5B50\u96C6\u7684effectScope\r\n    constructor(detached) {\r\n        // detached-->\u5224\u65AD\u662F\u4E0D\u662F\u72EC\u7ACB\uFF0C\u5982\u679C\u4E3Afalse\u72EC\u7ACB\uFF0C\u624D\u6536\u96C6\uFF0C\u5F53\u7236stop\uFF0C\u5B50\u4E5F\u4F1Astop\u3002\r\n        if (!detached && activeEffectsScope) {\r\n            activeEffectsScope.scopes.push(this);  //-->activeEffectsScope\u662F\u7236\u7EA7\r\n        }\r\n    }\r\n    run(fn) {\r\n        if (this.active) {\r\n            try {\r\n                this.parent = activeEffectsScope\r\n                activeEffectsScope = this\r\n                return fn();\r\n            } finally {\r\n                activeEffectsScope = this.parent\r\n            }\r\n        }\r\n    }\r\n    stop() {\r\n        if (this.active) {\r\n            for (let i = 0; i < this.effects.length; i++) {\r\n                this.effects[i].stop()\r\n            }\r\n            //   -->\u505C\u6B62\u5B50\u96C6\u7684\u4F9D\u8D56\r\n            for (let i = 0; i < this.scopes.length; i++) {\r\n                this.scopes[i].stop();\r\n            }\r\n\r\n            this.active = false\r\n        }\r\n\r\n    }\r\n}\r\n\r\nexport function effectScope(detached = false) {\r\n    return new EffectScope(detached)\r\n}\r\n\r\n//-->\u5728 effect.ts \u4E2D\uFF0C\u6267\u884Ceffect \u65F6\u6536\u96C6\u4F9D\u8D56\r\nexport function recordEffectScope(effect) {\r\n    //-->\u5728\u6267\u884Ceffect\u65F6\uFF0C\u83B7\u53D6\u5F53\u524D\u7684 activeEffectsScope ,\u5F80\u91CC\u9762\u6DFB\u52A0 effect\r\n    if (activeEffectsScope && activeEffectsScope.active) {\r\n        activeEffectsScope.effects.push(effect)\r\n    }\r\n\r\n}\r\n\r\n", "import { recordEffectScope } from \"./effectScope\";\r\n\r\nexport let activeEffect = undefined;\r\n\r\nfunction cleanupEffect(effect) {\r\n  const { deps } = effect;\r\n  for (let i = 0; i < deps.length; i++) {\r\n    /* \r\n    -->\u63A5\u89E6\u4F9D\u8D56\uFF0C\u91CD\u65B0\u89E6\u53D1 \r\n    --> \u5982\u679C\u76F8\u540C\u5730\u5740\uFF0C\u4F1A\u9020\u6210\u6DFB\u52A0\uFF0C\u5220\u9664\u6B7B\u5FAA\u73AF\r\n    --> \u89E3\u51B3: \u5728trigger\u6267\u884C\u65F6\uFF0C\u91CD\u65B0\u8BBE\u7F6E\u5730\u5740,\u907F\u514D\u540C\u4E00\u5730\u5740\u584C\u9677\r\n     */\r\n    deps[i].delete(effect);\r\n  }\r\n  effect.length = 0;\r\n}\r\nexport class ReactiveEffect {\r\n  public active = true; //-->\u662F\u5426\u6FC0\u6D3B\u72B6\u6001\r\n  public deps = []; //\u8BB0\u5F55\u5C5E\u6027\uFF0Cstop()\u65F6\uFF0C\u6E05\u7A7A\r\n  public parent = undefined; // -->\u7236\u4EB2\uFF0C\u89E3\u51B3\u4E0B\u9762\u95EE\u9898\r\n  constructor(public fn, public scheduler?) {\r\n    //public\u9ED8\u8BA4\u5C06fn\u7ED1\u5B9A\u5728this\r\n\r\n    recordEffectScope(this); //-->effectScope\u6536\u96C6\u4F9D\u8D56 \r\n    \r\n  }\r\n  run() {\r\n    if (!this.active) {\r\n      return this.fn(); //-->\u5982\u679C\u6CA1\u6709\u6FC0\u6D3B\uFF0C\u5219\u6267\u884Cfn,\u4E0D\u6536\u96C6\r\n    }\r\n    try {\r\n      this.parent = activeEffect;\r\n      activeEffect = this;\r\n\r\n      cleanupEffect(this); // -->\u89E6\u53D1\u524D\u6E05\u9664\u8BE5\u4F9D\u8D56\r\n\r\n      return this.fn(); //--> \u8C03\u7528\u53D6\u503C\uFF0C\u4F1A\u83B7\u53D6\u5168\u5C40activeEffect\r\n    } finally {\r\n      // activeEffect = undefined; // -->\u6536\u96C6\u6210\u529F\u540E\uFF0C\u6E05\u7A7A\u5168\u5C40activeEffect\r\n      activeEffect = this.parent;\r\n    }\r\n  }\r\n  stop() {\r\n    if (this.active) {\r\n      this.active = false;\r\n      cleanupEffect(this); // -->\u6E05\u9664\u4F9D\u8D56\r\n    }\r\n  }\r\n}\r\n\r\nexport function effect(fn, options: any = {}) {\r\n  const _effect = new ReactiveEffect(fn, options.scheduler);\r\n  _effect.run();\r\n\r\n  const runner = _effect.run.bind(_effect);\r\n  runner.effect = _effect;\r\n  return runner;\r\n}\r\n\r\nconst targetMap = new WeakMap();\r\nexport function track(target, type, key) {\r\n  if (!activeEffect) return;\r\n\r\n  let depsMap = targetMap.get(target);\r\n  if (!depsMap) {\r\n    targetMap.set(target, (depsMap = new Map()));\r\n  }\r\n\r\n  let dep = depsMap.get(key);\r\n  if (!dep) {\r\n    depsMap.set(key, (dep = new Set()));\r\n  }\r\n  // -->\u5224\u65AD\u662F\u5426\u6536\u96C6\u8FC7 --> \u6CA1\u6709\u5C31\u6536\u96C6\r\n  tarckEffect(dep);\r\n  // const shouldTrack = !dep.has(activeEffect);\r\n  // if (shouldTrack) {\r\n  //   dep.add(activeEffect);\r\n  //   activeEffect.deps.push(dep); // -- > \u53CD\u5411\u8BB0\u5F55\r\n  // }\r\n}\r\n//-->\u63D0\u53D6\u516C\u5171tarck\r\nexport function tarckEffect(dep) {\r\n  if (!activeEffect) return;\r\n  // -->\u5224\u65AD\u662F\u5426\u6536\u96C6\u8FC7 --> \u6CA1\u6709\u5C31\u6536\u96C6\r\n  const shouldTrack = !dep.has(activeEffect);\r\n  if (shouldTrack) {\r\n    dep.add(activeEffect);\r\n    activeEffect.deps.push(dep); // -- > \u53CD\u5411\u8BB0\u5F55\r\n  }\r\n}\r\n\r\nexport function trigger(target, type, key) {\r\n  const depsMap = targetMap.get(target);\r\n  // --> \u89E6\u53D1\u7684\u503C\u4E0D\u5728\u6A21\u677F\u4E2D\u3002\u4F8B\u5982{a:1},\u7136\u540Eb++ ,\u4E0D\u5728\u6A21\u677F\u4E2D\u4E0D\u89E6\u53D1\r\n  if (!depsMap) return;\r\n  let dep = depsMap.get(key);\r\n\r\n  if (dep) {\r\n    triggerEffect(dep);\r\n    // dep = [...dep]; //-->\u89E3\u51B3\u5206\u652F\u6B7B\u5FAA\u73AFbug\r\n    // dep.forEach(effect => {\r\n    //   // -->\u53EF\u80FD\u51FA\u73B0run\u65F6\u53C8\u5728\u5B58\u503C\r\n    //   if (effect !== activeEffect) {\r\n    //     if (effect.scheduler) {\r\n    //       effect.scheduler();\r\n    //     } else {\r\n    //       effect.run();\r\n    //     }\r\n    //   }\r\n    // });\r\n  }\r\n}\r\n\r\nexport function triggerEffect(dep) {\r\n  dep = [...dep]; //-->\u89E3\u51B3\u5206\u652F\u6B7B\u5FAA\u73AFbug\r\n  dep.forEach(effect => {\r\n    // -->\u53EF\u80FD\u51FA\u73B0run\u65F6\u53C8\u5728\u5B58\u503C\r\n    if (effect !== activeEffect) {\r\n      if (effect.scheduler) {\r\n        effect.scheduler();\r\n      } else {\r\n        effect.run(); //-->\u5237\u65B0\u8BD5\u56FE\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\n/*\r\n\r\n effect(() => {\r\n  state.name  //  -->parent===null , activeEffect\u662Fe1\r\n  effect(() => {\r\n    state.age // -- > parent===e1 , activeEffect\u662Fe2\r\n  });\r\n\r\n  state.user  // \u95EE\u9898-->\u56E0\u4E3Ae2\u5DF2\u7ECF\u6E05\u7A7AactiveEffect,\u6240\u4EE5\u8FD9\u91CC\u627E\u4E0D\u5230activeEffect\r\n              // \u89E3\u51B3--> activeEffect === parent\r\n});\r\n \r\n\u89E3\u51B3\u529E\u6CD5:\r\n1. \u5229\u7528\u5F39\u6808\u601D\u8DEF\uFF0C\u521B\u5EFA[e1,e2] ,\u8FDB\u5165\u5230e2,\u7136\u540E\u6E05\u9664\u6700\u540E\u4E00\u4E2A\uFF0Cuser\u5C31\u80FD\u83B7\u53D6[e1] \u6808\u91CC\u6700\u540E\u4E00\u4E2A\r\n\r\n2. \u67E5\u627E\u5BF9\u5E94parent\r\n\r\n*/\r\n", "export function MyIsObject(value: any): value is object {\r\n  return typeof value === 'object' && value !== null;\r\n}\r\n\r\nexport function MyIsFunction(value: any): value is Function {\r\n  return typeof value === 'function';\r\n}\r\n\r\nexport function MyIsString(value: any): value is string {\r\n  return typeof value === 'string';\r\n}\r\n\r\nexport function MyIsNumber(value: any): value is string {\r\n  return typeof value === 'number';\r\n}\r\n\r\n// -->\u67E5\u770B\u5BF9\u8C61\u8EAB\u4E0A\u662F\u5426\u6709\u67D0\u5C5E\u6027\r\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\r\nexport const hasOwn = (value, key) => hasOwnProperty.call(value, key);\r\n\r\n// -->\u8C03\u7528\u751F\u547D\u5468\u671F\u51FD\u6570\r\nexport const invokeArrayFunc = arr => {\r\n  for (let i = 0; i < arr.length; i++) {\r\n    const item = arr[i];\r\n    if (MyIsFunction(item)) {\r\n      item();\r\n    }\r\n  }\r\n};\r\n\r\nexport const enum ShapeFlags { //vue3\u63D0\u4F9B\u7684\u5F62\u72B6\u6807\u8BC6\uFF0C\u4F4D\u8FD0\u7B97\r\n  ELEMENT = 1,\r\n  FUNCTIONAL_COMPONENT = 1 << 1, //<<\u4F5C\u7528\u662F\u5411\u5DE6\u79FB\u52A8\u4E00\u4F4D\uFF0C\u4ECE001\u53D8\u6210010,\u5F97\u51FA2\r\n  STAEFUL_COMPONENT = 1 << 2,\r\n  TEXT_CHILDREN = 1 << 3,\r\n  ARRAY_CHILDREN = 1 << 4,\r\n  SLOTS_CHILDREN = 1 << 5,\r\n  TELEPORT = 1 << 6,\r\n  SUSPENSE = 1 << 7,\r\n  COMPONENT_SHOULD_KEEP_ALIVE = 1 << 8,\r\n  COMPONENT_KEPT_ALIVE = 1 << 9,\r\n  COMPOENT = ShapeFlags.STAEFUL_COMPONENT | ShapeFlags.FUNCTIONAL_COMPONENT,\r\n}\r\n\r\nexport const enum PatchFlags {\r\n  TEXT = 1, // \u52A8\u6001\u6587\u5B57\u5185\u5BB9\r\n\r\n  CLASS = 1 << 1, // \u52A8\u6001 class\r\n\r\n  STYLE = 1 << 2, // \u52A8\u6001\u6837\u5F0F\r\n\r\n  PROPS = 1 << 3, // \u52A8\u6001 props\r\n\r\n  FULL_PROPS = 1 << 4, // \u6709\u52A8\u6001\u7684key\uFF0C\u9700\u8981\u5B8C\u6574diff\r\n\r\n  HYDRATE_EVENTS = 1 << 5, // \u5408\u5E76\u4E8B\u4EF6\uFF0C\u6302\u8F7D\u4E8B\u4EF6\r\n\r\n  STABLE_FRAGMENT = 1 << 6, // children \u987A\u5E8F\u786E\u5B9A\u7684 fragment\r\n\r\n  KEYED_FRAGMENT = 1 << 7, // children\u4E2D\u6709\u5E26\u6709key\u7684\u8282\u70B9\u7684fragment\r\n\r\n  UNKEYED_FRAGMENT = 1 << 8, // \u6CA1\u6709key\u7684children\u7684fragment\r\n\r\n  NEED_PATCH = 1 << 9, // \u53EA\u6709\u975Eprops\u9700\u8981patch\u7684\uFF0C\u6BD4\u5982`ref`\r\n\r\n  DYNAMIC_SLOTS = 1 << 10, // \u52A8\u6001\u7684\u63D2\u69FD\r\n\r\n  // SPECIAL FLAGS -------------------------------------------------------------\r\n\r\n  // \u4EE5\u4E0B\u662F\u7279\u6B8A\u7684flag\uFF0C\u4E0D\u4F1A\u5728\u4F18\u5316\u4E2D\u88AB\u7528\u5230\uFF0C\u662F\u5185\u7F6E\u7684\u7279\u6B8Aflag\r\n  DEV_ROOT_FRAGMENT = 1 << 1,\r\n  // \u8868\u793A\u4ED6\u662F\u9759\u6001\u8282\u70B9\uFF0C\u4ED6\u7684\u5185\u5BB9\u6C38\u8FDC\u4E0D\u4F1A\u6539\u53D8\uFF0C\u5BF9\u4E8Ehydrate\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u4E0D\u4F1A\u9700\u8981\u518D\u5BF9\u5176\u5B50\u8282\u70B9\u8FDB\u884Cdiff\r\n  HOISTED = -1,\r\n  // \u7528\u6765\u8868\u793A\u4E00\u4E2A\u8282\u70B9\u7684diff\u5E94\u8BE5\u7ED3\u675F\r\n  BAIL = -2,\r\n}\r\n/* \r\n\r\n1 --> | \u4EE3\u8868\u8BA1\u7B97\uFF0C\u6BD4\u5982 1 0 0 ,\u662F4\uFF0C0 1 0 \u662F2\uFF0C\u3001\u901A\u8FC7\u8BA1\u7B97\uFF0C\u6BCF\u4E00\u4F4D\u5305\u542B1\u7684\uFF0C\u5C31\u5F97\u51FA\u4E86\u8FD9\u4E2A\u6570\u5B57\r\n\u7B54\u6848\uFF1A1 1 0,\u4EE3\u88686\r\n\r\n2 --> & \u662F\u8BA1\u7B97\u6709\u6CA1\u6709\u5305\u542B\uFF0C\u6BD4\u5982element\u662F001,COMPOENT\u662F110\uFF0C\u5982\u679C\u5BF9\u5E94\u7684\u503C\u4E00\u4E2A\u4E0D\u662F1\u5C31\u662F0\r\n\u7B54\u6848:\u5F97\u51FA\u4E0D\u5305\u542B\r\n\r\n\r\n*/\r\n", "import { MyIsObject, reactive } from '.';\r\nimport { track, trigger } from './effect';\r\n\r\nexport const enum ReactiveFlags {\r\n  IS_REACTIVE = '__v_isReactive', //\u5224\u65AD\u662F\u5426\u4EE3\u7406\u8FC7\r\n}\r\n\r\nexport const mutableHandlers = {\r\n  get(target, key, recevier) {\r\n    // \u4F20\u5165proxy--> \u8FDB\u5165\u4E0A\u9762if-->\u8FDB\u5165get\u65B9\u6CD5 -->\u5224\u65ADkey\r\n    if (key === ReactiveFlags.IS_REACTIVE) {\r\n      return true;\r\n    }\r\n    // --> \u4F9D\u8D56\u6536\u96C6\r\n    track(target, 'get', key);\r\n\r\n    const result = Reflect.get(target, key, recevier);\r\n    // -->\u5982\u679C\u662F\u5BF9\u8C61\uFF0C\u6DF1\u5EA6\u4EE3\u7406\r\n    if (MyIsObject(result)) {\r\n      return reactive(result);\r\n    }\r\n    return result;\r\n  },\r\n  set(target, key, newVal, recevier) {\r\n    const oldVal = target[key];\r\n    const result = Reflect.set(target, key, newVal, recevier);\r\n    if (oldVal !== newVal) {\r\n      trigger(target, 'set', key);\r\n    }\r\n    return result;\r\n  },\r\n};\r\n", "import { MyIsObject } from '@vue/shared';\r\nimport { mutableHandlers, ReactiveFlags } from './baseHandler';\r\nimport { effect } from './effect';\r\n\r\nconst reactiveMap = new WeakMap();\r\n\r\nexport function isReactive(value) {\r\n  //-->\u53CC\u611F\u53F9\u53F7\u8868\u793A\u8F6C\u4E3A\u5E03\u5C14\r\n  return !!(value && value[ReactiveFlags.IS_REACTIVE]);\r\n}\r\n\r\nexport function reactive(target) {\r\n  if (!MyIsObject(target)) return;\r\n\r\n  // 2. --> \u89E3\u51B3\u7528\u6237\u4F20\u5165proxy\u7684\u60C5\u51B5 --> \u8FDB\u5165\u4E0B\u9762get --> \u53EA\u6709\u4EE3\u7406\u5BF9\u8C61\u624D\u6709get,\u624D\u4F1A\u89E6\u53D1\u4E0B\u9762get\r\n  if (target[ReactiveFlags.IS_REACTIVE]) {\r\n    return target;\r\n  }\r\n\r\n  //  1.--> \u7F13\u5B58proxy,\u907F\u514D\u540C\u4E00\u4E2A\u5BF9\u8C61\u591A\u6B21\u88AB\u4EE3\u7406,\u95EE\u9898\u7528\u6237\u53EF\u80FD\u5C06proxy\u4F20\u5165reactive()\r\n  let exisitingProxy = reactiveMap.get(target);\r\n  if (exisitingProxy) return exisitingProxy;\r\n\r\n  //  recevier --> \u6539\u53D8\u8C03\u7528this\u6307\u5411\r\n  //  mutableHandlers -- > \u62BD\u79BB\u6838\u5FC3\u903B\u8F91\r\n  const proxy = new Proxy(target, mutableHandlers);\r\n\r\n  reactiveMap.set(target, proxy);\r\n  return proxy;\r\n}\r\n", "import { MyIsFunction } from '.';\r\nimport { ReactiveEffect, tarckEffect, triggerEffect } from './effect';\r\n\r\nclass ComputedRefImpl {\r\n  public effect; //-->\u7F13\u5B58\u7684\u503C\r\n  public _value;\r\n  public _dirty = true; //-->\u810F\u503C\r\n  public __v_isReadonly = true;\r\n  public __v_isRef = true;\r\n  public dep = new Set();\r\n  constructor(public getter, public setter) {\r\n    // -->\u8BA1\u7B97\u5C5E\u6027\u57FA\u4E8Eeffect\u4E0E\u8C03\u5EA6\u5668\u5B9E\u73B0\uFF0C\u5F53\u4F9D\u8D56\u66F4\u65B0\u89E6\u53D1trigger\u8C03\u7528schedule\r\n    this.effect = new ReactiveEffect(getter, () => {\r\n      console.log('sc');\r\n\r\n      // -->\u76D1\u542C\u7684\u503C\u66F4\u65B0\uFF0C\u8C03\u7528schedule\r\n      if (!this._dirty) {\r\n        this._dirty = true;\r\n        // -->\u5237\u65B0\u8BD5\u56FE\r\n        triggerEffect(this.dep);\r\n      }\r\n    });\r\n  }\r\n  // -->\u7C7B\u4E2D\u7684\u5C5E\u6027\u8BBF\u95EE\u5668\uFF0C\u5E95\u5C42\u662Fobject.defineProperty\r\n  get value() {\r\n    //   -->\u6536\u96C6\u4F9D\u8D56\uFF0C\u501F\u9274track\r\n    tarckEffect(this.dep);\r\n    // \u5224\u65AD\u810F\u503C-->\u8FD4\u56DE\u8BA1\u7B97\u5C5E\u6027\u7684\u503C\uFF0C\u8BA1\u7B97\u5C5E\u6027\u4EE3\u7406\u4E3Aeffect\r\n    if (this._dirty) {\r\n      this._dirty = false;\r\n      this._value = this.effect.run();\r\n    }\r\n    return this._value;\r\n  }\r\n  set value(newVal) {\r\n    this.setter(newVal); //--\u300B\u76F4\u63A5\u5C06\u65B0\u503C\u629B\u7ED9setter\u51FD\u6570\r\n  }\r\n}\r\n\r\nexport const computed = getterOrOptions => {\r\n  // 1-->\u4F20\u5165\u51FD\u6570\u662Fgetter\u6CA1\u6709setter,\u4F20\u5165\u5BF9\u8C61getter,setter\r\n  const onlyGetter = MyIsFunction(getterOrOptions);\r\n  let getter, setter;\r\n  if (onlyGetter) {\r\n    getter = getterOrOptions;\r\n    setter = () => {\r\n      console.warn('\u8BE5\u8BA1\u7B97\u5C5E\u6027\u53EA\u6709getter,\u6CA1\u6709setter');\r\n    };\r\n  } else {\r\n    getter = getterOrOptions.get;\r\n    setter = getterOrOptions.set;\r\n  }\r\n\r\n  return new ComputedRefImpl(getter, setter);\r\n};\r\n", "import { MyIsObject, MyIsFunction } from '.';\r\nimport { ReactiveEffect } from './effect';\r\nimport { isReactive } from './reactive';\r\n\r\nfunction traversal(value, set = new Set()) {\r\n  // 1-->\u7EC8\u7ED3\u6761\u4EF6\uFF1A\u4E0D\u662F\u5BF9\u8C61\u9000\u51FA\r\n  if (!MyIsObject(value)) return value;\r\n\r\n  // 2.-->\u907F\u514D\u5FAA\u73AF\u5F15\u7528\uFF0C\u68C0\u67E5\u662F\u5426\u5DF2\u7ECF\u8BBF\u95EE\u8FC7\r\n  if (set.has(value)) return value;\r\n\r\n  set.add(value);\r\n  for (let key in value) {\r\n    traversal(value[key], set);\r\n  }\r\n\r\n  return value;\r\n}\r\nexport function watch(source, cb) {\r\n  let getter;\r\n  let oldValue;\r\n  // 1-->\u5224\u65AD\u4F20\u5165\u7684source\u662F\u4E0D\u662F\u54CD\u5E94\u5F0F,\u7136\u540E\u8F6C\u4E3A\u51FD\u6570\r\n  if (isReactive(source)) {\r\n    getter = () => traversal(source); //-->\u9700\u8981\u9012\u5F52\u89E6\u53D1get\u6536\u96C6\r\n  } else if (MyIsFunction(source)) {\r\n    getter = source;\r\n  }\r\n  let cleanup;\r\n  const onCleanup = fn => {\r\n    cleanup = fn;\r\n  };\r\n\r\n  const job = () => {\r\n    if (cleanup) {\r\n      cleanup();\r\n    }\r\n    const newValue = effect.run();\r\n    cb(newValue, oldValue, onCleanup); //-->cb\u5C31\u662Fwatch\u4F20\u5165\u7684\u7B2C\u4E8C\u4E2A\u56DE\u8C03\r\n    oldValue = newValue;\r\n  };\r\n  const effect = new ReactiveEffect(getter, job);\r\n  oldValue = effect.run(); //-->\u8FD4\u56DE\u76D1\u63A7\u7684\u503C\r\n}\r\n", "import { MyIsObject, reactive } from '.';\r\nimport { tarckEffect, triggerEffect } from './effect';\r\nimport { isReactive } from './reactive';\r\n\r\nfunction toReactive(value) {\r\n  // -->\u5982\u679C\u662F\u5BF9\u8C61\uFF0C\u9700\u8981\u8F6C\u4E3A\u54CD\u5E94\u5F0F\r\n  return MyIsObject(value) ? reactive(value) : value;\r\n}\r\n\r\nclass RefImpl {\r\n  public __v_isRef = true;\r\n  public __v_isShallow = true;\r\n  public _value;\r\n  public dep = new Set();\r\n  constructor(public _rawValue) {\r\n    this._value = toReactive(this._rawValue); //\u521D\u59CB\u5316\u503C,\u5982\u679C\u662F\u5BF9\u8C61,\u9012\u5F52proxy\r\n  }\r\n  get value() {\r\n    //   -->\u548Ccomputed\u4E00\u6837\uFF0C\u6536\u96C6\u4F9D\u8D56\r\n    tarckEffect(this.dep);\r\n    return this._value;\r\n  }\r\n  set value(newValue) {\r\n    if (newValue !== this._rawValue) {\r\n      // -->\u65B0\u503C\u4E5F\u9700\u8981\u8F6C\u6362\u4E3Aproxy\r\n      this._value = toReactive(newValue);\r\n      this._rawValue = newValue;\r\n      //   -->\u89E6\u53D1\u4F9D\u8D56\r\n      triggerEffect(this.dep);\r\n    }\r\n  }\r\n}\r\n\r\n//1-->ref\u5C31\u662F\u5C06\u5BF9\u8C61\u6216\u8005\u975E\u5BF9\u8C61new\u5B9E\u4F8B\uFF0C\u7136\u540E\u6536\u96C6\u89E6\u53D1\u4F9D\u8D56\r\nexport function ref(value) {\r\n  return new RefImpl(value);\r\n}\r\n\r\n/*      toRefs        */\r\n\r\n// ObjectRefImpl-->\u53EA\u662F\u5C06.value\u5C5E\u6027\u4EE3\u7406\u5230\u539F\u59CB\u7C7B\u578B\u4E0A\r\nclass ObjectRefImpl {\r\n  constructor(public object, public key) {}\r\n  get value() {\r\n    return this.object[this.key];\r\n  }\r\n  set value(newValue) {\r\n    this.object[this.key] = newValue;\r\n  }\r\n}\r\nexport function toRef(object, key) {\r\n  return new ObjectRefImpl(object, key);\r\n}\r\n\r\n// -->toRefs\u5C31\u662F\u5C06reactive\u54CD\u5E94\u5F0F\u8F6C\u4E3Aref\u5B9E\u4F8B\u7684\u65B9\u6CD5\r\nexport function toRefs(object) {\r\n  // -->\u5224\u65AD\u662F\u4E0D\u662Freactive,\u4E0D\u662F\u7ED9\u51FA\u63D0\u793A\r\n  if (!isReactive(object)) {\r\n    console.warn(\r\n      'toRefs \u53EA\u63A5\u53D7reactive\u54CD\u5E94\u503C,vue.global.js:1501 toRefs() expects a reactive object but received a plain one.'\r\n    );\r\n  }\r\n\r\n  // 1-->\u53EF\u4EE5\u4F20\u5165\u6570\u636E\u4E0E\u5BF9\u8C61\uFF0C\u7136\u540E\u4FBF\u5229\r\n  const result = Array.isArray(object) ? new Array(object.length) : {};\r\n  // 2-->\u904D\u5386\u91CC\u9762\u6BCF\u4E2A\u503C\uFF0C\u8F6C\u4E3Aref\r\n  for (let key in object) {\r\n    result[key] = toRef(object, key);\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\n/*   proxyRefs       */\r\n// \u5C06ref\u5B9E\u4F8B\u8F6C\u4E3Aproxy,\u4E0D\u9700\u8981\u901A\u8FC7.value\u8BBF\u95EE\uFF0C\u53CD\u5411\u8F6C\u6362\r\nexport function proxyRefs(object) {\r\n  return new Proxy(object, {\r\n    get(target, key, recevier) {\r\n      const r = Reflect.get(target, key, recevier);\r\n\r\n      // -->\u5224\u65AD\u662F\u4E0D\u662Fref\u503C\uFF0C\u7701\u53BB.value\u6B65\u9AA4\r\n      return r.__v_isRef ? r.value : r;\r\n    },\r\n    set(target, key, newVal, recevier) {\r\n      const oldValue = Reflect.get(target, key, recevier);\r\n      //  -->\u5224\u65AD\u8001\u503C\u662F\u4E0D\u662Fref\r\n      if (oldValue.__v_isRef) {\r\n        oldValue.value = newVal;\r\n        return true;\r\n      } else {\r\n        const r = Reflect.set(target, key, newVal, recevier);\r\n\r\n        return r;\r\n      }\r\n    },\r\n  });\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
